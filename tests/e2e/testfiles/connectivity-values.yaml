- scenario: "Install/uninstall APEX Connectivity Client"
  paths:
    - "testfiles/connectivity_client.yaml"
  tags:
    - "sanity"
    - "client"
  steps:
    - "Given a client environment with k8s or openshift, and CSM operator installed"
    - "Install connectivity client from CR [1] and create secret [testfiles/connectivity_client_secret.yaml]"
    - "Validate connectivity client from CR [1] is installed"
    - "Uninstall connectivity client from CR [1]"
    - "Uninstall connectivity client secret from CR [2]"
    - "Validate connectivity client from CR [1] is not installed"
- scenario: "Upgrade APEX Connectivity Client"
  paths:
    - "testfiles/connectivity_client.yaml"
    - "testfiles/connectivity_client_1.yaml"
  tags:
    - "sanity"
    - "client"
  steps:
    - "Given a client environment with k8s or openshift, and CSM operator installed"
    - "Install connectivity client from CR [1] and create secret [testfiles/connectivity_client_secret.yaml]"
    - "Validate connectivity client from CR [1] is installed"
    - "Upgrade client from custom resource [1] to [2]"
    - "Validate connectivity client from CR [2] is installed"
    - "Uninstall connectivity client from CR [2]"
    - "Uninstall connectivity client secret from CR [3]"
    - "Validate connectivity client from CR [2] is not installed"
- scenario: "Validate role/rolebindings created for brownfield-onboard scenario"
  paths:
    - "testfiles/connectivity_client.yaml"
    - "testfiles/storage_csm_powerflex.yaml"
  tags:
    - "sanity"
    - "client"
  steps:
    - "Given a client environment with k8s or openshift, and CSM operator installed"
    - "Set up secret with template [testfiles/powerflex-templates/powerflex-secret-template.yaml] name [test-vxflexos-config] in namespace [test-vxflexos] for [pflex]"
    - "Apply custom resource [2]"
    - "Validate custom resource [2]"
    - "Validate [powerflex] driver from CR [2] is installed"
    - "Install connectivity client from CR [1] and create secret [testfiles/connectivity_client_secret.yaml]"
    - "Validate connectivity client from CR [1] is installed"
    - "Validate rbac created in namespace [test-vxflexos]"
    - "Uninstall connectivity client from CR [1]"
    - "Validate connectivity client from CR [1] is not installed"
    - "Validate connectivity client rbac objects are removed from all namespaces"
    - "Enable forceRemoveDriver on CR [2]"
    - "Delete custom resource [2]"
    - "Restore template [testfiles/powerflex-templates/powerflex-secret-template.yaml] for [pflex]"
    - "Restore template [testfiles/powerflex-templates/powerflex-storageclass-template.yaml] for [pflex]"
- scenario: "Validate rbac objects created for brownfield scenario when the client is running and CSM is created"
  paths:
    - "testfiles/connectivity_client.yaml"
    - "testfiles/storage_csm_powerflex.yaml"
  tags:
    - "sanity"
    - "client"
  steps:
    - "Given a client environment with k8s or openshift, and CSM operator installed"
    - "Install connectivity client from CR [1] and create secret [testfiles/connectivity_client_secret.yaml]"
    - "Validate connectivity client from CR [1] is installed"
    - "Set up secret with template [testfiles/powerflex-templates/powerflex-secret-template.yaml] name [test-vxflexos-config] in namespace [test-vxflexos] for [pflex]"
    - "Apply custom resource [2]"
    - "Validate custom resource [2]"
    - "Validate [powerflex] driver from CR [2] is installed"
    - "Validate rbac created in namespace [test-vxflexos]"
    - "Enable forceRemoveDriver on CR [2]"
    - "Delete custom resource [2]"
    - "Validate connectivity client rbac objects are removed from namespace [test-vxflexos]"
    - "Uninstall connectivity client from CR [1]"
    - "Validate connectivity client from CR [1] is not installed"
    - "Validate connectivity client rbac objects are removed from all namespaces"
    - "Restore template [testfiles/powerflex-templates/powerflex-secret-template.yaml] for [pflex]"
    - "Restore template [testfiles/powerflex-templates/powerflex-storageclass-template.yaml] for [pflex]"
