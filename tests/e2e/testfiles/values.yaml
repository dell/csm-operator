# List of E2E Tests Scenarios
- scenario: "Install PowerScale Driver(Standalone)"
  path: "testfiles/storage_csm_powerscale.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    # name of custom test to run
    name: Cert CSI
    # Provide command-line argument to run. Ginkgo will run the command and return output
    # The command should be accessible from e2e_test repo. The cert-csi path is supplied in the values file.
    # Example:
    #   ./hello_world.sh
    #   cert-csi test vio --sc <storage class> --chainNumber 2 --chainLength 2
    run: ./cert-csi test vio --sc isilon --chainNumber 2 --chainLength 2

- scenario: "Install PowerScale Driver(With Authorization)"
  path: "testfiles/storage_csm_powerscale_auth.yaml"
  modules:
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: Cert CSI
    run: ./cert-csi test vio --sc isilon --chainNumber 2 --chainLength 2

- scenario: "Install PowerScale Driver(Standalone), Enable Authorization"
  path: "testfiles/storage_csm_powerscale.yaml"
  modules:
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Enable [authorization] module from CR [1]"
    - "Set secret for driver from CR [1] to [test-isilon-creds-auth]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: HelloWorld 
    run: "echo Hello && echo World"



- scenario: "Install PowerScale Driver(With Replication)"
  path: "testfiles/storage_csm_powerscale_replica.yaml"
  modules:
    - "replication"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [replication] module from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: HelloWorld 
    run: "echo Hello && echo World"

- scenario: "Install PowerScale Driver(Standalone), Enable Replication"
  path: "testfiles/storage_csm_powerscale.yaml"
  modules:
    - "replication"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [replication] module from CR [1] is not installed"
    - "Enable [replication] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [replication] module from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: HelloWorld 
    run: "echo Hello && echo World"


- scenario: "Uninstall PowerScale Driver"
  path: "testfiles/storage_csm_powerscale.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is not installed"

- scenario: Install PowerScale Driver(With Authorization), Disable Authorization module"
  path: "testfiles/storage_csm_powerscale_auth.yaml"
  modules:
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Disable [authorization] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: Install PowerScale Driver(With Replication), Disable Replication module"
  path: "testfiles/storage_csm_powerscale_replica.yaml"
  modules:
    - "replication"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [replication] module from CR [1] is installed"
    - "Disable [replication] module from CR [1]"
    - "Validate [replication] driver from CR [1] is installed"
    - "Validate [replication] module from CR [1] is not installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"


- scenario: "Install PowerScale Driver(With Observability)"
  path: "testfiles/storage_csm_powerscale_observability.yaml"
  modules:
    - "observability"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: "Install PowerScale Driver(Standalone), Enable Observability"
  path: "testfiles/storage_csm_powerscale.yaml"
  modules:
    - "observability"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is not installed"
    - "Enable [observability] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: Install PowerScale Driver(With Observability), Disable Observability module"
  path: "testfiles/storage_csm_powerscale_observability.yaml"
  modules:
    - "observability"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    - "Disable [observability] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is not installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: "Install PowerScale Driver(With Authorization and Observability)"
  path: "testfiles/storage_csm_powerscale_observability_auth.yaml"
  modules:
    - "observability"
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: Cert CSI
    run: ./cert-csi test vio --sc isilon --chainNumber 2 --chainLength 2

- scenario: "Install PowerScale Driver(Standalone), Enable Authorization, Enable Observability"
  path: "testfiles/storage_csm_powerscale.yaml"
  modules:
    - "observability"
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Validate [observability] module from CR [1] is not installed"
    - "Enable [authorization] module from CR [1]"
    - "Set secret for driver from CR [1] to [test-isilon-creds-auth]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Validate [observability] module from CR [1] is not installed"
    - "Enable [observability] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: Install PowerScale Driver(With Authorization and Observability), Disable Observability module, Disable Authorization module"
  path: "testfiles/storage_csm_powerscale_observability_auth.yaml"
  modules:
    - "observability"
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    - "Disable [observability] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Validate [observability] module from CR [1] is not installed"
    - "Disable [authorization] module from CR [1]"
    - "Set secret for driver from CR [1] to [test-isilon-creds]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Validate [observability] module from CR [1] is not installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: Install PowerScale Driver(With Authorization and Observability), Disable Authorization module, Disable Observability module"
  path: "testfiles/storage_csm_powerscale_observability_auth.yaml"
  modules:
    - "observability"
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    - "Disable [authorization] module from CR [1]"
    - "Set secret for driver from CR [1] to [test-isilon-creds]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Validate [observability] module from CR [1] is installed"
    - "Disable [observability] module from CR [1]"
    - "Validate [powerscale] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Validate [observability] module from CR [1] is not installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"


- scenario: "Install PowerFlex Driver(Standalone)"
  path: "testfiles/storage_csm_powerflex.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    # name of custom test to run
    name: Cert CSI
    # Provide command-line argument to run. Ginkgo will run the command and return output
    # The command should be accessible from e2e_test repo. The cert-csi path is supplied in the values file.
    # Example:
    #   ./hello_world.sh
    #   cert-csi test vio --sc <storage class> --chainNumber 2 --chainLength 2
    run: ./cert-csi test vio --sc vxflexos --chainNumber 2 --chainLength 2

- scenario: "Uninstall PowerFlex Driver"
  path: "testfiles/storage_csm_powerflex.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is not installed"

- scenario: "Install PowerFlex Driver (With Authorization)"
  path: "testfiles/storage_csm_powerflex_auth.yaml"
  modules:
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Set secret for driver from CR [1] to [test-vxflexos-config-auth]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: Cert CSI
    run: ./cert-csi test vio --sc vxflexos --chainNumber 2 --chainLength 2

- scenario: "Install PowerFlex Driver(Standalone), Enable Authorization"
  path: "testfiles/storage_csm_powerflex.yaml"
  modules:
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powersflex] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Enable [authorization] module from CR [1]"
    - "Set secret for driver from CR [1] to [test-vxflexos-config-auth]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: Cert CSI
    run: ./cert-csi test vio --sc vxflexos --chainNumber 2 --chainLength 2

- scenario: Install PowerFlex Driver(With Authorization), Disable Authorization module"
  path: "testfiles/storage_csm_powerflex_auth.yaml"
  modules:
    - "authorization"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Set secret for driver from CR [1] to [test-vxflexos-config-auth]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is installed"
    - "Run custom test"
    - "Disable [authorization] module from CR [1]"
    - "Set secret for driver from CR [1] to [test-vxflexos-config]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [authorization] module from CR [1] is not installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
  customTest:
    name: Cert CSI
    run: ./cert-csi test vio --sc vxflexos --chainNumber 2 --chainLength 2

- scenario: "Install PowerFlex Driver(With Observability)"
  path: "testfiles/storage_csm_powerflex_observability.yaml"
  modules:
    - "observability"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: "Install PowerFlex Driver(Standalone), Enable Observability"
  path: "testfiles/storage_csm_powerflex.yaml"
  modules:
    - "observability"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is not installed"
    - "Enable [observability] module from CR [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"

- scenario: Install PowerFlex Driver(With Observability), Disable Observability module"
  path: "testfiles/storage_csm_powerflex_observability.yaml"
  modules:
    - "observability"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Apply custom resource [1]"
    - "Validate custom resource [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is installed"
    - "Disable [observability] module from CR [1]"
    - "Validate [powerflex] driver from CR [1] is installed"
    - "Validate [observability] module from CR [1] is not installed"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [1]"
    - "Delete custom resource [1]"
