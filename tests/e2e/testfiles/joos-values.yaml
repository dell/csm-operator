# List of E2E Tests Scenarios
- scenario: "Install PowerScale Driver(Standalone)"
  CRs:
    powerscale: "testfiles/storage_csm_powerscale.yaml"
  configFiles:
    storageclass: "testfiles/powerscale-templates/powerscale-storageclass-template.yaml"
    secret: "testfiles/powerscale-templates/powerscale-secret-template.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Create namespace [test-isilon]"
    - "Create storageclass with name [op-e2e-isilon] from template [storageclass] for [pscale]"
    - "Create secret from template [secret] named [test-isilon-creds] in namespace [test-isilon] for [pscale]"
    - "Apply custom resource [powerscale]"
    - "Validate custom resource [powerscale]"
    - "Validate [powerscale] driver from CR [powerscale] is installed"
    - "Run custom test"
    # Last three steps perform Clean Up
    - "Enable forceRemoveDriver on CR [powerscale]"
    - "Delete custom resource [powerscale]"
    - "Restore template [secret] for [pscale]"
    - "Restore template [storageclass] for [pscale]"
    - "Delete namespace [test-isilon]"
  customTest:
    name: Cert CSI
    run: 
      - ./cert-csi test vio --sc op-e2e-isilon --chainNumber 2 --chainLength 2

- scenario: "Install PowerScale Driver with first alternate sample file"
  CRs: 
    powerscale: "testfiles/storage_csm_powerscale_alt_vals_1.yaml"
  configFiles:
    storageclass: "testfiles/powerscale-templates/powerscale-storageclass-template-altifs.yaml"
    secret: "testfiles/powerscale-templates/powerscale-secret-template.yaml"
    cert0: "testfiles/powerscale-cert-secret-0.yaml"
    cert1: "testfiles/powerscale-cert-secret-1.yaml"
    cert2: "testfiles/powerscale-cert-secret-2.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Create namespace [dell]"
    - "Create storageclass with name [powerscale-altifs] from template [storageclass] for [pscale]"
    - "Create secret from template [secret] named [csm-creds] in namespace [dell] for [pscale]"
    - "Apply yaml file [cert0]"
    - "Apply yaml file [cert1]"
    - "Apply yaml file [cert2]"
    - "Apply custom resource [powerscale]"
    - "Validate custom resource [powerscale]"
    - "Validate [powerscale] driver from CR [powerscale] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [powerscale]"
    - "Delete custom resource [powerscale]"
    - "Delete yaml file [cert0]"
    - "Delete yaml file [cert1]"
    - "Delete yaml file [cert2]"
    - "Restore template [secret] for [pscale]"
    - "Restore template [storageclass] for [pscale]"
    - "Delete namespace [dell]"
  customTest:
    name: Cert CSI and check_parameters.sh
    run: 
      - ./cert-csi test vio --sc powerscale-altifs --chainNumber 2 --chainLength 2
      - /bin/bash check_parameters.sh testfiles/powerscale_alt_vals_1_values.csv dell powerscale

- scenario: "Install PowerScale Driver with second alternate sample file"
  CRs: 
    powerscale: "testfiles/storage_csm_powerscale_alt_vals_2.yaml"
  configFiles:
    storageclass: "testfiles/powerscale-templates/powerscale-storageclass-template.yaml"
    secret: "testfiles/powerscale-templates/powerscale-secret-template.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Create namespace [dell]"
    - "Create storageclass with name [op-e2e-isilon] from template [storageclass] for [pscale]"
    - "Create secret from template [secret] named [csm-creds] in namespace [dell] for [pscale]"
    - "Apply custom resource [powerscale]"
    - "Validate custom resource [powerscale]"
    - "Validate [powerscale] driver from CR [powerscale] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [powerscale]"
    - "Delete custom resource [powerscale]"
    - "Restore template [secret] for [pscale]"
    - "Restore template [storageclass] for [pscale]"
    - "Delete namespace [dell]"
  customTest:
    name: Cert CSI and check_parameters.sh
    run: 
      - ./cert-csi test vio --sc op-e2e-isilon --chainNumber 2 --chainLength 2
      - /bin/bash check_parameters.sh testfiles/powerscale_alt_vals_2_values.csv dell powerscale

- scenario: "Install PowerScale Driver with third alternate sample file"
  CRs: 
    powerscale: "testfiles/storage_csm_powerscale_alt_vals_3.yaml"
  configFiles:
    storageclass: "testfiles/powerscale-templates/powerscale-storageclass-template.yaml"
    secret: "testfiles/powerscale-templates/powerscale-secret-template.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Set [control-plane] node label"
    - "Create namespace [dell]"
    - "Create storageclass with name [op-e2e-isilon] from template [storageclass] for [pscale]"
    - "Create secret from template [secret] named [csm-creds] in namespace [dell] for [pscale]"
    - "Apply custom resource [powerscale]"
    - "Validate custom resource [powerscale]"
    - "Validate [powerscale] driver from CR [powerscale] is installed"
    - "Run custom test"
    # Last four steps perform Clean Up. Need to reinstall pscale with forceRemoveDriver to fully clean delete
    - "Remove [control-plane] node label"
    - "Enable forceRemoveDriver on CR [powerscale]"
    - "Delete custom resource [powerscale]"
    - "Restore template [secret] for [pscale]"
    - "Restore template [storageclass] for [pscale]"
    - "Delete namespace [dell]"
  customTest:
    name: Cert CSI and check_parameters.sh
    run: 
      - ./cert-csi test vio --sc op-e2e-isilon --chainNumber 2 --chainLength 2
      - /bin/bash check_parameters.sh testfiles/powerscale_alt_vals_3_values.csv dell powerscale

- scenario: "Install PowerScale Driver with health monitor"
  CRs: 
    powerscale: "testfiles/storage_csm_powerscale_health_monitor.yaml"
  configFiles:
    storageclass: "testfiles/powerscale-templates/powerscale-storageclass-template.yaml"
    secret: "testfiles/powerscale-templates/powerscale-secret-template.yaml"
  modules:
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Create namespace [dell]"
    - "Create storageclass with name [op-e2e-isilon] from template [storageclass] for [pscale]"
    - "Create secret from template [secret] named [csm-creds] in namespace [dell] for [pscale]"
    - "Apply custom resource [powerscale]"
    - "Validate custom resource [powerscale]"
    - "Validate [powerscale] driver from CR [powerscale] is installed"
    - "Run custom test"
    # Last two steps perform Clean Up
    - "Enable forceRemoveDriver on CR [powerscale]"
    - "Delete custom resource [powerscale]"
    - "Restore template [secret] for [pscale]"
    - "Restore template [storageclass] for [pscale]"
    - "Delete namespace [dell]"
  customTest:
    name: Cert CSI and check_parameters.sh
    run: 
      - ./cert-csi test vio --sc op-e2e-isilon --chainNumber 2 --chainLength 2
      - /bin/bash check_parameters.sh testfiles/powerscale_health_monitor_values.csv dell powerscale

