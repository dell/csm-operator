- scenario: "Install Application Mobility v1.03 and upgrade to v1.1.0"
  paths:
    - "testfiles/application-mobility-templates/csm_application_mobility_old.yaml"
    - "testfiles/application-mobility-templates/csm_application_mobility_with_pflex.yaml"
  tags:
    - "applicationmobility"
    - "sanity"
  steps:
    - "Given an environment with k8s or openshift, and CSM operator installed"
    - "Set up application mobility CR [testfiles/application-mobility-templates/csm_application_mobility_old.yaml]"
    - "Set up application mobility CR [testfiles/application-mobility-templates/csm_application_mobility_with_pflex.yaml]"
    - "Create storageclass with name [op-e2e-vxflexos] and template [testfiles/powerflex-templates/powerflex-storageclass-template.yaml] for [pflex]"
    - "Set up secret with template [testfiles/powerflex-templates/powerflex-secret-template.yaml] name [vxflexos-app-mobility-config] in namespace [test-vxflexos] for [pflex]"
    - "Apply custom resource [1]"
    - "Validate [application-mobility] module from CR [1] is installed"
    - "Validate [powerflex] driver from CR [1] is installed"
    #upgrade
    - "Upgrade from custom resource [1] to [2]"
    - "Validate custom resource [2]"
    - "Validate [application-mobility] module from CR [2] is installed"
    #clean up
    - "Restore template [testfiles/powerflex-templates/powerflex-secret-template.yaml] for [pflex]"
    - "Restore template [testfiles/powerflex-templates/powerflex-storageclass-template.yaml] for [pflex]"
    - "Restore template [testfiles/application-mobility-templates/csm_application_mobility_with_pflex.yaml] for [application-mobility]"
    - "Restore template [testfiles/application-mobility-templates/csm_application_mobility_old.yaml] for [application-mobility]"
    - "Enable forceRemoveModule on CR [1]"
    - "Delete custom resource [2]"